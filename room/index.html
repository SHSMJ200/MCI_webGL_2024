<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Room with Objects</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="instructions">Click to Start</div>
    
    <script>
        // Create Scene, Camera, Renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Room Dimensions
        const roomWidth = 100, roomHeight = 10, roomDepth = 100;
        const wallMaterial2 = new THREE.MeshBasicMaterial({ color: 0xaaaaaa, side: THREE.DoubleSide });
        const wallMaterial = new THREE.MeshBasicMaterial({ color: 0x003355, side: THREE.DoubleSide });

        // Back Wall
        const backWall = new THREE.Mesh(new THREE.PlaneGeometry(roomWidth, roomHeight), wallMaterial);
        backWall.position.set(0, 0, -roomDepth / 2);
        scene.add(backWall);

        const frontWall = new THREE.Mesh(new THREE.PlaneGeometry(roomWidth, roomHeight), wallMaterial);
        frontWall.position.set(0, 0, roomDepth / 2); // Corrected
        scene.add(frontWall);


        // Left Wall
        const leftWall = new THREE.Mesh(new THREE.PlaneGeometry(roomDepth, roomHeight), wallMaterial);
        leftWall.position.set(-roomWidth / 2, 0, 0);
        leftWall.rotation.y = Math.PI / 2;
        scene.add(leftWall);

        // Right Wall
        const rightWall = new THREE.Mesh(new THREE.PlaneGeometry(roomDepth, roomHeight), wallMaterial);
        rightWall.position.set(roomWidth / 2, 0, 0);
        rightWall.rotation.y = -Math.PI / 2;
        scene.add(rightWall);

        // Floor
        const floor = new THREE.Mesh(new THREE.BoxGeometry(roomWidth, 1, roomDepth), wallMaterial2);
        floor.position.set(0, -roomHeight / 2 - 0.5, 0);
        scene.add(floor);

        // Ceiling
        const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(roomWidth, roomDepth), wallMaterial2);
        ceiling.position.set(0, roomHeight / 2, 0);
        ceiling.rotation.x = Math.PI / 2;
        scene.add(ceiling);

        // Start Camera Inside the Room
        camera.position.set(0, 0, 8);

        // Table
        const tableGeometry = new THREE.BoxGeometry(3, 0.2, 2);
        const tableMaterial = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
        const table = new THREE.Mesh(tableGeometry, tableMaterial);
        table.position.set(0, -4, 0);
        scene.add(table);

        // Table Legs
        function createTableLeg(x, z) {
            const legGeometry = new THREE.BoxGeometry(0.2, 3, 0.2);
            const leg = new THREE.Mesh(legGeometry, tableMaterial);
            leg.position.set(x, -5.5, z);
            scene.add(leg);
        }
        createTableLeg(-1.2, -0.8);
        createTableLeg(1.2, -0.8);
        createTableLeg(-1.2, 0.8);
        createTableLeg(1.2, 0.8);

        // Chair
        const chairSeatGeometry = new THREE.BoxGeometry(1.5, 0.2, 1.5);
        const chairSeat = new THREE.Mesh(chairSeatGeometry, tableMaterial);
        chairSeat.position.set(-4, -4.5, 0);
        scene.add(chairSeat);

        // Chair Legs
        function createChairLeg(x, z) {
            const legGeometry = new THREE.BoxGeometry(0.2, 2, 0.2);
            const leg = new THREE.Mesh(legGeometry, tableMaterial);
            leg.position.set(x, -5.5, z);
            scene.add(leg);
        }
        createChairLeg(-4.6, -0.6);
        createChairLeg(-3.4, -0.6);
        createChairLeg(-4.6, 0.6);
        createChairLeg(-3.4, 0.6);

        // Chair Backrest
        const backrestGeometry = new THREE.BoxGeometry(1.5, 2, 0.2);
        const backrest = new THREE.Mesh(backrestGeometry, tableMaterial);
        backrest.position.set(-4, -3.5, -0.6);
        scene.add(backrest);

        // Lamp (Now Positioned on the Table)
        const lampBaseGeometry = new THREE.CylinderGeometry(0.4, 0.6, 0.2, 32);
        const lampBaseMaterial = new THREE.MeshBasicMaterial({ color: 0x444444 });
        const lampBase = new THREE.Mesh(lampBaseGeometry, lampBaseMaterial);
        lampBase.position.set(0.5, -3.8, 0.5); // On top of the table
        scene.add(lampBase);

        const lampStandGeometry = new THREE.CylinderGeometry(0.1, 0.1, 1.5, 32);
        const lampStand = new THREE.Mesh(lampStandGeometry, lampBaseMaterial);
        lampStand.position.set(0.5, -3.1, 0.5);
        scene.add(lampStand);

        const lampShadeGeometry = new THREE.ConeGeometry(0.8, 1.2, 32);
        const lampShadeMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });
        const lampShade = new THREE.Mesh(lampShadeGeometry, lampShadeMaterial);
        lampShade.position.set(0.5, -2.3, 0.5);
        scene.add(lampShade);

        // Add a Light Source Above the Lamp
        const lampLight = new THREE.PointLight(0xffffaa, 1, 10);
        lampLight.position.set(0.5, -2, 0.5);
        scene.add(lampLight);

        function addEdges(mesh) {
            const edges = new THREE.EdgesGeometry(mesh.geometry);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x000000 }); // Black edges
            const edgeMesh = new THREE.LineSegments(edges, lineMaterial);
            mesh.add(edgeMesh); // Attach edges to the object
        }

        addEdges(floor);
        addEdges(ceiling);
        addEdges(leftWall);
        addEdges(rightWall);
        addEdges(backWall);
        addEdges(frontWall);


        // Movement & Rotation Variables
        const speed = 0.2;
        let keys = {};
        let yaw = 0, pitch = 0;
        const sensitivity = 0.002;

        // Capture Key Presses
        window.addEventListener("keydown", (event) => keys[event.code] = true);
        window.addEventListener("keyup", (event) => keys[event.code] = false);

        // Enable Pointer Lock on Click
        document.getElementById("instructions").addEventListener("click", () => {
            document.body.requestPointerLock();
            document.getElementById("instructions").style.display = "none";
        });

        // Mouse Look
        document.addEventListener("mousemove", (event) => {
            if (document.pointerLockElement === document.body) {
                yaw -= event.movementX * sensitivity;
                pitch -= event.movementY * sensitivity;
                pitch = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, pitch));
                camera.rotation.set(pitch, yaw, 0);
            }
        });

        // Movement Function
        function animate() {
            requestAnimationFrame(animate);

            const forward = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.quaternion);
            const right = new THREE.Vector3(1, 0, 0).applyQuaternion(camera.quaternion);

            if (keys["KeyW"]) camera.position.add(forward.multiplyScalar(speed)); 
            if (keys["KeyS"]) camera.position.add(forward.multiplyScalar(-speed)); 
            if (keys["KeyA"]) camera.position.add(right.multiplyScalar(-speed)); 
            if (keys["KeyD"]) camera.position.add(right.multiplyScalar(speed)); 

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
